@model IEnumerable<NCR>

@{
    ViewData["Title"] = "Dashboard";
}

<div>
    <h1>NCR</h1>

    <nav class="main-nav ncr navbar-expand-sm navbar-toggleable-sm">
        <ul class="navbar-nav">
            <li class="nav-item">
                <a class="nav-link" asp-area="" asp-controller="NCR" asp-action="Index" onclick="activateLink(this)">NCR log</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" asp-area="" asp-controller="NCR" asp-action="Analytics" onclick="activateLink(this)">Analytics</a>
                <hr />
            </li>
            <li class="nav-item">
                <a class="nav-link" asp-area="" asp-controller="NCR" asp-action="Archived" onclick="activateLink(this)">Archived NCRs</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" asp-area="" asp-controller="NCR" asp-action="Archiving" onclick="activateLink(this)">Archiving helper</a>
            </li>

        </ul>
        <hr />

    </nav>
    <div class="dropdown ncr-mobile-nav">
        <button class="dropdown-toggle" type="button" id="dropdownMenu2" data-bs-toggle="dropdown" aria-expanded="false">
            <i class="bi bi-list"></i>
        </button>
        <ul class="dropdown-menu" aria-labelledby="dropdownMenu2">
            <li><a class="nav-link" asp-area="" asp-controller="NCR" asp-action="Index" onclick="activateLink(this)">NCR log</a></li>
            <li><a class="nav-link" asp-area="" asp-controller="NCR" asp-action="Analytics" onclick="activateLink(this)">Analytics</a></li>
            <li><a class="nav-link" asp-area="" asp-controller="NCR" asp-action="Archived" onclick="activateLink(this)">Archived NCRs</a></li>
            <li><a class="nav-link" asp-area="" asp-controller="NCR" asp-action="Archiving" onclick="activateLink(this)">Archiving helper</a></li>
        </ul>
        <h2>Analytics</h2>
        <hr />
    </div>
</div>


<div class="row dashboard-cards analytics">
    <div class="col-md-12 stats-cards-dashboard">
        <div class="row analytics">
            <div class="col-md-6">
                <div class="card" style="width: 100%;">
                    <div class="card-body">
                        <h5 class="card-title">NCRs in <b>Quality Rep.</b></h5>
                        <p class="card-text">@ViewBag.QualityRepresentativeCount</p>
                    </div>
                </div>
                <div class="card" style="width: 100%;">
                    <div class="card-body">
                        <h5 class="card-title">NCRs in <b>Engineering</b></h5>
                        <p class="card-text">@ViewBag.EngineeringCount</p>
                    </div>
                </div>
                <div class="card" style="width: 100%;">
                    <div class="card-body">
                        <h5 class="card-title">NCRs in <b>Operations</b></h5>
                        <p class="card-text">@ViewBag.PurchasingCount</p>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card" style="width: 100%;">
                    <div class="card-body">
                        <h5 class="card-title">NCRs in <b>Procurement</b></h5>
                        <p class="card-text">@ViewBag.ProcurementCount</p>
                    </div>
                </div>
                <div class="card" style="width: 100%;">
                    <div class="card-body">
                        <h5 class="card-title">NCRs in <b>Reinspection</b></h5>
                        <p class="card-text">@ViewBag.ReinspectionCount</p>
                    </div>
                </div>
                <div class="card" style="width: 100%;">
                    <div class="card-body">
                        <h5 class="card-title">Active NCRs</h5>
                        <p class="card-text">@ViewBag.ncrCount</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-md-7">
        <div class="card chart">
            <div class="card-body">
                <div class="chart-card-header">
                    <h5 class="card-title">Parts Defective</h5>
                    <i class="bi bi-info-circle-fill"></i>
                    <div>
                        <div class="form-group col-md-6">
                            @Html.DropDownList("SupplierID", null, "All Suppliers", htmlAttributes: new { @class = "form-select" })
                        </div>
                        <div class="form-group col-md-6">
                            <input class="form-control" list="datalistOptions" id="exampleDataList" placeholder="Type to search...">
                            <datalist id="datalistOptions">
                            </datalist>
                        </div>
                    </div>
                </div>

                <div>
                    <h6>This month</h6>
                    <h2>45<span class="badge">+10%<i class="bi bi-triangle-fill"></i></span></h2>
                    <div>
                        <canvas id="line-chart" style="width: 100%; height: auto;"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="col-md-5">
        <div class="table-box">
            <h4>Overdue NCRs</h4>

            <div class="d-none d-lg-block">
                <table class="table table-borderless">
                    <thead>
                        <tr>
                            <th>
                                NCR NO.
                            </th>
                            <th>
                                STATUS
                            </th>
                            <th>
                                PHASE
                            </th>
                            <th>
                                PO OR PROD NO.
                            </th>
                            <th>
                                SUPPLIER
                            </th>
                            <th>
                                CREATED ON
                            </th>

                            <th></th>
                        </tr>
                    </thead>

                    <tbody class="ncr-list-row">
                        @foreach (var item in Model)
                        {
                            <tr class="grey-rows">
                                <td>
                                    <div>@Html.DisplayFor(modelItem => item.NCRNum)</div>
                                </td>
                                <td>
                                    @if (item.Status == "Active")
                                    {
                                        <span style="color: var(--green);">@Html.DisplayFor(modelItem => item.Status)</span>
                                    }
                                    else if (item.Status == "Closed")
                                    {
                                        <span style="color: var(--yellow);">@Html.DisplayFor(modelItem => item.Status)</span>
                                    }
                                    else if (item.Status == "Rejected" || item.Status == "Rejected Again")
                                    {
                                        <span style="color: var(--red);">@Html.DisplayFor(modelItem => item.Status)</span>
                                    }
                                </td>
                                <td>
                                    @Html.DisplayFor(modelItem => item.Phase)
                                </td>
                                <td>
                                    @Html.DisplayFor(modelItem => item.QualityRepresentative.PoNo)
                                </td>
                                <td>
                                    @Html.DisplayFor(modelItem => item.QualityRepresentative.Supplier.SupplierName)
                                </td>
                                <td>
                                    @Html.DisplayFor(modelItem => item.CreatedOn)
                                </td>
                                <td>
                                    <a class="btn btn-primary" asp-controller="NCR" asp-action="Details" asp-route-id="@item.ID"><i class="bi bi-card-list"></i>Details</a>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>

            </div>

            <div class="ncr-cards container-fluid d-block d-lg-none">
                <div class="row">
                    @foreach (var item in Model)
                    {
                        <div class="card mb-3">
                            <div class="card-header">
                                <p>@Html.DisplayFor(modelItem => item.NCRNum)</p>
                                @if (item.Status == "Active")
                                {
                                    <span style="color: var(--green);">@Html.DisplayFor(modelItem => item.Status)</span>
                                }
                                else if (item.Status == "Closed")
                                {
                                    <span style="color: var(--yellow);">@Html.DisplayFor(modelItem => item.Status)</span>
                                }
                                else if (item.Status == "Rejected" || item.Status == "Rejected Again")
                                {
                                    <span style="color: var(--red);">@Html.DisplayFor(modelItem => item.Status)</span>
                                }
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col">
                                        <p><strong>Phase:</strong> @Html.DisplayFor(modelItem => item.Phase)</p>
                                        <p><strong>PO Number:</strong> @Html.DisplayFor(modelItem => item.QualityRepresentative.PoNo)</p>
                                        <p><strong>Supplier:</strong> @Html.DisplayFor(modelItem => item.QualityRepresentative.Supplier.SupplierName)</p>
                                        <p><strong>Created On:</strong> @Html.DisplayFor(modelItem => item.CreatedOn)</p>
                                    </div>
                                    <div class="col">
                                        <a class="btn btn-primary" asp-controller="NCR" asp-action="Details" asp-route-id="@item.ID"><i class="bi bi-card-list"></i> Details</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>
    
</div>

<div class="table-box">
    <h4>Overdue NCRs</h4>

    <div class="d-none d-lg-block">
        <table class="table table-borderless">
            <thead>
                <tr>
                    <th>
                        NCR NO.
                    </th>
                    <th>
                        STATUS
                    </th>
                    <th>
                        PHASE
                    </th>
                    <th>
                        PO OR PROD NO.
                    </th>
                    <th>
                        SUPPLIER
                    </th>
                    <th>
                        CREATED ON
                    </th>

                    <th></th>
                </tr>
            </thead>

            <tbody class="ncr-list-row">
                @foreach (var item in Model)
                {
                    <tr class="grey-rows">
                        <td>
                            <div>@Html.DisplayFor(modelItem => item.NCRNum)</div>
                        </td>
                        <td>
                            @if (item.Status == "Active")
                            {
                                <span style="color: var(--green);">@Html.DisplayFor(modelItem => item.Status)</span>
                            }
                            else if (item.Status == "Closed")
                            {
                                <span style="color: var(--yellow);">@Html.DisplayFor(modelItem => item.Status)</span>
                            }
                            else if (item.Status == "Rejected" || item.Status == "Rejected Again")
                            {
                                <span style="color: var(--red);">@Html.DisplayFor(modelItem => item.Status)</span>
                            }
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.Phase)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.QualityRepresentative.PoNo)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.QualityRepresentative.Supplier.SupplierName)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.CreatedOn)
                        </td>
                        <td>
                            <a class="btn btn-primary" asp-controller="NCR" asp-action="Details" asp-route-id="@item.ID"><i class="bi bi-card-list"></i>Details</a>
                        </td>
                    </tr>
                }
            </tbody>
        </table>

    </div>

    <div class="ncr-cards container-fluid d-block d-lg-none">
        <div class="row">
            @foreach (var item in Model)
            {
                <div class="card mb-3">
                    <div class="card-header">
                        <p>@Html.DisplayFor(modelItem => item.NCRNum)</p>
                        @if (item.Status == "Active")
                        {
                            <span style="color: var(--green);">@Html.DisplayFor(modelItem => item.Status)</span>
                        }
                        else if (item.Status == "Closed")
                        {
                            <span style="color: var(--yellow);">@Html.DisplayFor(modelItem => item.Status)</span>
                        }
                        else if (item.Status == "Rejected" || item.Status == "Rejected Again")
                        {
                            <span style="color: var(--red);">@Html.DisplayFor(modelItem => item.Status)</span>
                        }
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col">
                                <p><strong>Phase:</strong> @Html.DisplayFor(modelItem => item.Phase)</p>
                                <p><strong>PO Number:</strong> @Html.DisplayFor(modelItem => item.QualityRepresentative.PoNo)</p>
                                <p><strong>Supplier:</strong> @Html.DisplayFor(modelItem => item.QualityRepresentative.Supplier.SupplierName)</p>
                                <p><strong>Created On:</strong> @Html.DisplayFor(modelItem => item.CreatedOn)</p>
                            </div>
                            <div class="col">
                                <a class="btn btn-primary" asp-controller="NCR" asp-action="Details" asp-route-id="@item.ID"><i class="bi bi-card-list"></i> Details</a>
                            </div>
                        </div>
                    </div>
                </div>
            }
        </div>
    </div>
</div>

@section Scripts {

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="~/lib/jquery/dist/jquery.min.js"></script>

    <script>
        $(document).ready(function () {
            $.ajax({
                type: "POST",
                url: "NCR/GenChart",
                data: "",
                contextType: "application/json; charset=utf8",
                dataType: "json",
                success: OnSuccess,
            });

            function OnSuccess(data) {
                const myChart = document.getElementById('line-chart');
                var _data = data;
                var _labels = _data[0];
                var _ChartData = _data[1];

                new Chart(myChart,{
                    type: 'line',
                    data: {
                        labels: _labels,
                        datasets: [{
                            backgroundColor: colors,
                            data: _ChartData,
                            borderWidth: 1,
                            borderColor: "#3e95cd",
                            fill: false
                        }]
                    },
                    options: {
                        title: {
                            display: true,
                            text: 'World population per region (in millions)'
                        }
                    }
                })

            }
        });
        // new Chart(document.getElementById("line-chart"), {
        //     type: 'line',
        //     data: {
        //         labels: [1500, 1600, 1700, 1750, 1800, 1850, 1900, 1950, 1999, 2050],
        //         datasets: [{
        //             data: [86, 114, 106, 106, 107, 111, 133, 221, 783, 2478],
        //             label: "Africa",
        //             borderColor: "#3e95cd",
        //             fill: false
        //         }, {
        //             data: [282, 350, 411, 502, 635, 809, 947, 1402, 3700, 5267],
        //             label: "Asia",
        //             borderColor: "#8e5ea2",
        //             fill: false
        //         }, {
        //             data: [168, 170, 178, 190, 203, 276, 408, 547, 675, 734],
        //             label: "Europe",
        //             borderColor: "#3cba9f",
        //             fill: false
        //         }, {
        //             data: [40, 20, 10, 16, 24, 38, 74, 167, 508, 784],
        //             label: "Latin America",
        //             borderColor: "#e8c3b9",
        //             fill: false
        //         }, {
        //             data: [6, 3, 2, 2, 7, 26, 82, 172, 312, 433],
        //             label: "North America",
        //             borderColor: "#c45850",
        //             fill: false
        //         }
        //         ]
        //     },
        //     options: {
        //         title: {
        //             display: true,
        //             text: 'World population per region (in millions)'
        //         }
        //     }
        // });
        
    </script>

}
